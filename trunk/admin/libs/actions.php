<script>var oDialogo;String.prototype.trim = function() {	return this.replace(/^\s+|\s+$/g,"");}String.prototype.ltrim = function() {	return this.replace(/^\s+/,"");}String.prototype.rtrim = function() {	return this.replace(/\s+$/,"");}function showHelp(fileHelp){	conHelp=crearXMLHttpRequest();	conHelp.onreadystatechange = cbShowHelp;	//obtiene la estructura del listado	conHelp.open('GET',fileHelp, true);	conHelp.send(null);	}function cbShowHelp(){	if(conHelp.readyState == 4)	{		document.getElementById("panel_ayuda_content_text").innerHTML=conHelp.responseText;		document.getElementById("panel_ayuda").style.display="block";		document.getElementById("panel_ayuda_content").style.display="block";			}}function cbCargarComboByTable(){	if(conCargarComboByTable.readyState == 4)	{		if(conCargarComboByTable.responseText!=""){			removeRequest();		    var datos=JSON.parse(conCargarComboByTable.responseText);		    conCargarComboByTable=null;		    if (colaCargaComboByTable.length>0){		    	k=colaCargaComboByTable.length-1;		    	cargarComboByTable(colaCargaComboByTable[k][0],colaCargaComboByTable[k][1],colaCargaComboByTable[k][2],colaCargaComboByTable[k][3],colaCargaComboByTable[k][4],colaCargaComboByTable[k][5]);		    	colaCargaComboByTable.splice(k,1);		    }		    var valor=datos[0]		    var combo=datos[1]		    var columns=datos[2];		    if (columns==null)		    	total=0;		    else		    	total=columns.length-1;		    var select=document.getElementById(combo);		    select.innerHTML="";			select.options[select.options.length]=new Option(" ","");		    for(i=0;i<=total;i++){		    	/*var option=document.createElement("option");		    	option.value=columns[i]['_key'];		    	alert(option.text);		    	option.text=columns[i]['value'];		    	alert(option.text);		    	document.getElementById(combo).appendChild(option);*/		    			    	select.options[select.options.length] = new Option(columns[i]['value'], columns[i]['_key']);		    }		    document.getElementById(combo).value=valor;		    if (select.onchange!=null)		    	select.onchange();		 }	}}var conHook;var colaHook=new Array();var mhookChild="";var mIdEntidad=0;function loadHook(hook,parent,estado,col, idEntidad, helpFile){	if(estado!=undefined && estado!="undefined" && estado!=""){		document.getElementById('estado').innerHTML=estado+"<div id='link_ayuda'></div>";		document.getElementById('estado').style.backgroundColor="#"+col;	}	if(helpFile!="")		document.getElementById('link_ayuda').innerHTML="<a href='javascript:showHelp(\"<?=HELP_PATH?>"+helpFile+"\")' >Ayuda</ayuda>";	if(conHook==null){		if(parent!="")			mhookChild=parent;		conHook=crearXMLHttpRequest();		conHook.onreadystatechange = cbLoadHook;		//obtiene la estructura del listado		conHook.open('GET','<?=HOOK_PATH?>'+hook, true);		mIdEntidad=idEntidad;		conHook.send(null);	}else{		var item=new Array(3)		item[0]=hook;		item[1]=parent;		item[2]=estado;		item[3]=col;		colaHook[colaHook.length]=item;	}	}function cbLoadHook(){	if(conHook.readyState == 4)	{		html=conHook.responseText;				if (mhookChild!=""){			document.getElementById("panel_listado_child"+mhookChild).innerHTML=html;		}else{						document.getElementById("panel_hook").innerHTML=html;			document.getElementById("panel_hook").style.display="block";			document.getElementById("panel_listado").style.display="none";			document.getElementById("panel_detalle").style.display="none";			cbHook(mIdEntidad);		}		mhookChild="";		removeRequest();		conHook=null;		if (colaHook.length>0){			k=colaHook.length-1;			loadHook(colaHook[k][0],colaHook[k][1],colaHook[k][2],colaHook[k][3]);			colaHook.splice(k,1);		}	}}function closeHelp(){	document.getElementById("panel_ayuda_content").style.display="none";	document.getElementById("panel_ayuda").style.display="none";}function crearSelectsDate(key){		html="<select id='"+key+"d'>"	for (i=1;i<=31;i++)		html="<option value="+i+">"+i+"</option>";	html="</select>";	html="<select id='"+key+"m'>"	for (i=1;i<=12;i++)		html="<option value="+i+">"+i+"</option>";	html="</select>";	html="<select id='"+key+"y'>"	d=new Date();	y=d.getYear();	for (i=d-5;i<=d+1;i++)		html="<option value="+i+">"+i+"</option>";	html="</select>";	return html;}function crearCampoFecha(key){	YAHOO.util.Event.onDOMReady(function(){        var Event = YAHOO.util.Event,            Dom = YAHOO.util.Dom,            dialog,            calendar;        var showBtn = Dom.get("show"+key);        Event.on(showBtn, "click", function() {            // Lazy Dialog Creation - Wait to create the Dialog, and setup document click listeners, until the first time the button is clicked.            if (!dialog) {                // Hide Calendar if we click anywhere in the document other than the calendar                Event.on(document, "click", function(e) {                    var el = Event.getTarget(e);                    var dialogEl = dialog.element;                    if (el != dialogEl && !Dom.isAncestor(dialogEl, el) && el != showBtn && !Dom.isAncestor(showBtn, el)) {                        dialog.hide();                    }                });                function resetHandler() {                    // Reset the current calendar page to the select date, or                     // to today if nothing is selected.                    var selDates = calendar.getSelectedDates();                    var resetDate;                            if (selDates.length > 0) {                        resetDate = selDates[0];                    } else {                        resetDate = calendar.today;                    }                            calendar.cfg.setProperty("pagedate", resetDate);                    calendar.render();                }                        function closeHandler() {                    dialog.hide();                }                dialog = new YAHOO.widget.Dialog("container", {                    visible:false,                    context:["show"+key, "tl", "bl"],                    buttons:[ {text:"Reset", handler: resetHandler, isDefault:true}, {text:"Close", handler: closeHandler}],                    draggable:false,                    close:true                });                dialog.setHeader('Seleccione...');                dialog.setBody('<div id="cal'+key+'"></div>');                dialog.render(document.body);                dialog.showEvent.subscribe(function() {                    if (YAHOO.env.ua.ie) {                        // Since we're hiding the table using yui-overlay-hidden, we                         // want to let the dialog know that the content size has changed, when                        // shown                        dialog.fireEvent("changeContent");                    }                });            }            // Lazy Calendar Creation - Wait to create the Calendar until the first time the button is clicked.            if (!calendar) {                calendar = new YAHOO.widget.Calendar("cal"+key, {                    iframe:false,          // Turn iframe off, since container has iframe support.                    hide_blank_weeks:true  // Enable, to demonstrate how we handle changing height, using changeContent                });                calendar.render();                calendar.selectEvent.subscribe(function() {                    if (calendar.getSelectedDates().length > 0) {                        var selDate = calendar.getSelectedDates()[0];                        // Pretty Date Output, using Calendar's Locale values: Friday, 8 February 2008                        var dStr = selDate.getDate();                        var mStr = selDate.getMonth()+1;                        var yStr = selDate.getFullYear();                                Dom.get(key).value = dStr + "/" + mStr + "/" + yStr;                    } else {                        Dom.get(key).value = "";                    }                    dialog.hide();                });                calendar.renderEvent.subscribe(function() {                    // Tell Dialog it's contents have changed, which allows                     // container to redraw the underlay (for IE6/Safari2)                    dialog.fireEvent("changeContent");                });            }            var seldate = calendar.getSelectedDates();            if (seldate.length > 0) {                // Set the pagedate to show the selected date if it exists                calendar.cfg.setProperty("pagedate", seldate[0]);                calendar.render();            }            dialog.show();        });    });}<?php//carga los idiomas en una array accesibleinclude("./libs/session.php");if ($_SESSION[CT_LANGUAGES]){	include("./config/database.php");	$rs=$db->get_results("select id_idioma, des_idioma, des_corta from t_idiomas",ARRAY_A);	$numIdiomas=sizeof($rs);	echo "var numIdiomas=".$numIdiomas.";";	echo "var aIdiomas=new Array(".$numIdiomas.");";	for ($i=0;$i<$numIdiomas;$i++){		echo "aIdiomas[".$i."]=new Array(2);";		echo "aIdiomas[".$i."][0]='".$rs[$i]["id_idioma"]."';";		echo "aIdiomas[".$i."][1]='".$rs[$i]["des_corta"]."';";	}}else	echo "var numIdiomas=0;";?>var lastReturn;function checkPass(id){	if(document.getElementById("_"+id)!=null){		if (document.getElementById(id).value!=document.getElementById("_"+id).value){			alert("Las contrase\xF1as no coinciden");			document.getElementById(id).focus();			lastReturn=false;		}else			lastReturn=true;	}	return lastReturn;}    function cancelarDetalle(child){	if (child==undefined){		document.getElementById("panel_listado").style.display="block";		document.getElementById("panel_detalle").style.display="none";	}else{		document.getElementById("panel_listado_child"+child).style.display="block";		document.getElementById("panel_detalle_child"+child).style.display="none";	}}function aceptarDetalle(child){	if (child!=undefined)		bActualizar=document.getElementById("_key_"+child).value!="";	else		bActualizar=document.getElementById("_key").value!="";	if (bActualizar)		actualizar(child);	else		insertar(child);}//ACTUALIZARvar conActualizar;function actualizar(child){	var ok=true;	if (child!=undefined)		var f=document.getElementById("form_detail_child"+child);	else		var f=document.getElementById("form_detail");	var fields=f.elements.length;	var params="";	var edit=0;	for (i=0;i<fields;i++){		if (f.elements[i].type=="password")			ok=checkPass(f.elements[i].id);		if ((f.elements[i].type=="textarea" && myEditor[edit]!=null && myEditor[edit][0]==f.elements[i].id) || f.elements[i].title=="kk"){			myEditor[edit][1].saveHTML(); 	    	//The var html will now have the contents of the textarea 	    	var html = myEditor[edit][1].get('element').value; 	    	params+=f.elements[i].id+"="+escape(html)+"&";	    	edit++;		}else{			if (f.elements[i].type=="checkbox")				params+=f.elements[i].id+"="+(f.elements[i].checked?'S':'N')+"&";			else				params+=f.elements[i].id+"="+escape(f.elements[i].value)+"&";		}	}	if (ok){		conActualizar=crearXMLHttpRequest();		conActualizar.onreadystatechange = cbActualizar;		//obtiene la estructura del listado				conActualizar.open('POST','libs/actions/actualizar.php', true);		conActualizar.setRequestHeader("Content-type", "application/x-www-form-urlencoded");		conActualizar.setRequestHeader("Content-length", params.length);		conActualizar.setRequestHeader("Connection", "close");		addRequest();		conActualizar.send(params);	}		/*if (child!=undefined){		document.getElementById("panel_listado_child"+child).style.display="block";		document.getElementById("panel_detalle_child"+child).style.display="none";	}*/	}function cbActualizar(){	if(conActualizar.readyState == 4)	{		a=conActualizar.responseText.split("#");		if (a[0]=="OK"){			var idEntidad=a[1];			var parent=a[2];			var bListar=a[3]=="S";			var byUser=a[4]=="S";			var keyValue=a[5];			var key=a[6];			if (parent!=""){				frmAdjuntos="frm_adjuntos_child"+idEntidad;				document.getElementById("panel_listado_child"+idEntidad).style.display="block";				document.getElementById("panel_detalle_child"+idEntidad).style.display="none";			}else{				frmAdjuntos="frm_adjuntos";                        }						//ya se puede subir el adjunto			if (document.getElementById(frmAdjuntos)!=null){				document.getElementById(frmAdjuntos).submit();			}else{				if (parent!=""){					if (bListar)						listar(idEntidad,parent);					else{						if(keyValue==""){							consultar(idEntidad,key)						}else{							consultar(idEntidad,keyValue,parent)                                                }					}										document.getElementById("panel_listado_child"+idEntidad).style.display="block";					document.getElementById("panel_detalle_child"+idEntidad).style.display="none";				}				else{					if (bListar){						listar(idEntidad);					}else{						if (byUser){							consultar(idEntidad,'<?=$_SESSION[constant(USER.PROJECT)]?>');						}else{							if(keyValue=="")								consultar(idEntidad,key)							else								consultar(idEntidad,'1');						}                                      }                          }                          }									}		else{			if (a[0]=="KO"){				var campo=document.getElementById(a[1]);				campo.className="required";				var isIE = document.all ? 1 : 0; 				if (campo.tagName.tolowercase()=="select" && isIE)					campo.parentNode.className="required";				campo.focus();			}else				alert(conActualizar.responseText);		}		removeRequest();				}}//INSERTARvar conInsertar;function insertar(child){	var ok=true	if (child!=undefined)		var f=document.getElementById("form_detail_child"+child);	else		var f=document.getElementById("form_detail");		var fields=f.elements.length;	var params="";	var edit=0;	for (i=0;i<fields;i++){		if (f.elements[i].type=="password")			ok=checkPass(f.elements[i].id);		if (f.elements[i].type=="textarea" && myEditor[edit]!=null && myEditor[edit][0]==f.elements[i].id){			myEditor[edit][1].saveHTML(); 	    	//The var html will now have the contents of the textarea 	    	var html = myEditor[edit][1].get('element').value; 	    	params+=f.elements[i].id+"="+escape(html)+"&";	    	edit++;		}else{			if (f.elements[i].type=="checkbox")				params+=f.elements[i].id+"="+(f.elements[i].checked?'S':'N')+"&";			else				params+=f.elements[i].id+"="+escape(f.elements[i].value)+"&";		}		}		if (ok){		conInsertar=crearXMLHttpRequest();		conInsertar.onreadystatechange = cbInsertar;		//obtiene la estructura del listado		conInsertar.open('POST','libs/actions/insertar.php', true);		conInsertar.setRequestHeader("Content-type", "application/x-www-form-urlencoded");		conInsertar.setRequestHeader("Content-length", params.length);		conInsertar.setRequestHeader("Connection", "close");		addRequest();		conInsertar.send(params);			}	//if (child!=undefined){		//document.getElementById("panel_listado_child"+child).style.display="block";		//document.getElementById("panel_detalle_child"+child).style.display="none";	//}	}function cbInsertar(){	if(conInsertar.readyState == 4)	{		a=conInsertar.responseText.split("#");		if (a[0]=="OK"){			var idEntidad=a[2];			var parent=a[3];			var bListar=a[4]=="S";			var keyValue=a[5];			var key=a[6];			if (parent!="")				frmAdjuntos="frm_adjuntos_child"+idEntidad;			else				frmAdjuntos="frm_adjuntos";						//ya se puede subir el adjunto			if (document.getElementById(frmAdjuntos)!=null){				if (parent!=""){					document.getElementById(frmAdjuntos)["_key_"+idEntidad].value=a[1];					document.getElementById("panel_listado_child"+idEntidad).style.display="block";					document.getElementById("panel_detalle_child"+idEntidad).style.display="none";				}else					document.getElementById(frmAdjuntos)._key.value=a[1];				document.getElementById(frmAdjuntos).submit();			}			else{				if (parent!=""){					if (bListar)						listar(idEntidad,parent);					else{						if(keyValue=="")							consultar(idEntidad,key)						else							consultar(idEntidad,keyValue,parent)					}											document.getElementById("panel_listado_child"+idEntidad).style.display="block";					document.getElementById("panel_detalle_child"+idEntidad).style.display="none";				}else{					if (bListar)						listar(idEntidad);					else{						if(keyValue=="")							consultar(idEntidad,key)						else							consultar(idEntidad,keyValue,parent)					}				}			}		}		else{			if (a[0]=="KO"){				var campo=document.getElementById(a[1]);				campo.className="required";				var isIE = document.all ? 1 : 0; 				var s=""+campo.tagName;				if (campo.tagName.toLowerCase()=="select" && isIE){					campo.parentNode.className="required";				}				campo.focus();			}else				alert(conInsertar.responseText);		}		removeRequest();	}}//HOOK CHILDvar conHookChild;var colaHookChild=new Array();function hookChild(idEntidad, parentKey ,hook){	if (conHookChild==null){		conHookChild=crearXMLHttpRequest();		conHookChild.onreadystatechange = cbHookChild;		//obtiene la estructura del listado		conHookChild.open('GET','<?=HOOK_PATH?>'+hook+'?i='+idEntidad+"&p="+parentKey, true);		addRequest()		conHookChild.send(null);	}else{		var item=new Array(3)		item[0]=idEntidad;		item[1]=parentKey;		item[2]=hook;		colaHookChild[colaHookChild.length]=item;	}}function cbHookChild(){	if(conHookChild.readyState == 4)	{			var response=conHookChild.responseText;		var pos=response.indexOf("#");		var pos2=response.indexOf("#",pos+1);		var isChild=response.substring(0,pos)=="S";		var idEntidad=response.substring(pos+1,pos2);		var html=response.substring(pos2+1);		var container="listado";		if (isChild)			container="listado_child"+idEntidad;	    document.getElementById(container).innerHTML=html;		conHookChild=null;		cbHook(idEntidad);		if (colaHookChild.length>0){			k=colaHookChild.length-1;			hookChild(colaHookChild[k][0],colaHookChild[k][1],colaHookChild[k][2]);			colaHookChild.splice(k,1);		}		removeRequest(); 	}}//SPECIAL LAYOUTvar conSpecial;var colaSpecial=new Array();function specialLayout(idEntidad, parentKey ,layout){	if (conSpecial==null){		conSpecial=crearXMLHttpRequest();		conSpecial.onreadystatechange = cbSpecialLayout;		//obtiene la estructura del listado		conSpecial.open('GET','libs/actions/specialLayout.php?i='+idEntidad+"&p="+parentKey+"&l="+layout, true);		addRequest()		conSpecial.send(null);	}else{		var item=new Array(3)		item[0]=idEntidad;		item[1]=parentKey;		item[2]=layout;		colaSpecial[colaSpecial.length]=item;	}}function cbSpecialLayout(){	if(conSpecial.readyState == 4)	{			var response=conSpecial.responseText;		var pos=response.indexOf("#");		var pos2=response.indexOf("#",pos+1);		var isChild=response.substring(0,pos)=="S";		var idEntidad=response.substring(pos+1,pos2);		var html=response.substring(pos2+1);		var container="listado";		if (isChild)			container="listado_child"+idEntidad;	    document.getElementById(container).innerHTML=html;		conSpecial=null;				if (colaSpecial.length>0){			k=colaSpecial.length-1;			specialLayout(colaSpecial[k][0],colaSpecial[k][1],colaSpecial[k][2]);			colaSpecial.splice(k,1);		}		removeRequest(); 	}}//LISTARvar conListar;var colaListar=new Array();var myDataTable;function listar(idEntidad, parentKey ,estado,col){	if(estado!=undefined && estado!="undefined" && estado!=""){					document.getElementById('estado').innerHTML=estado+"<div id='link_ayuda'></div>";				document.getElementById('estado').style.backgroundColor="#"+col;	}				if (conListar==null){		conListar=crearXMLHttpRequest();		conListar.onreadystatechange = cbListar;		//obtiene la estructura del listado		if (parentKey==undefined)			conListar.open('GET','libs/actions/listar.php?i='+idEntidad+"&def=1", true);		else			conListar.open('GET','libs/actions/listar.php?i='+idEntidad+"&p="+parentKey+"&def=1", true);		addRequest()		conListar.send(null);	}else{		var item=new Array(2)		item[0]=idEntidad;		item[1]=parentKey;		colaListar[colaListar.length]=item;	}		}function cbListar(){	if(conListar.readyState == 4)	{				YAHOO.example.DynamicData = function() { 	    // Column definitions 	    var datos=JSON.parse(conListar.responseText);	    conListar=null;	    if (colaListar.length>0){	    	k=colaListar.length-1;	    	listar(colaListar[k][0],colaListar[k][1]);	    	colaListar.splice(k,1);	    }	    var columns=datos[0];	    var entity=datos[1];	    total=columns.length-1;	    var myColumnDefs=new Array(total);	    		if(entity['help_file']!="")			document.getElementById('link_ayuda').innerHTML="<a href='javascript:showHelp(\"<?=HELP_PATH?>"+entity['help_file']+"\")' >Ayuda</ayuda>";	    	    var myCustomImage = function(elCell, oRecord, oColumn, oData) {			elCell.innerHTML = '<center><img src="'+getThumb(oData)+'"/></a></center>';		}		YAHOO.widget.DataTable.Formatter.myCustomI = myCustomImage;		var myCustomUnescape= function(elCell, oRecord, oColumn, oData) {			elCell.innerHTML = unescape(oData);		}		YAHOO.widget.DataTable.Formatter.myCustomUnescape= myCustomUnescape;	    	    	    hasPass=false;	    var order="";	    for(i=0;i<=total;i++){			if (columns[i]['isPass']){				hasPass=true;				myColumnDefs[i]={key:columns[i]['key'], hidden:true};			}else{		    	if (columns[i]['key']=="_entity")		    		myColumnDefs[i]={key:columns[i]['key'], hidden:true};		    	else			    	if (columns[i]['key']=="_key")			    		myColumnDefs[i]={key:columns[i]['key'], label:columns[i]['label'], sortable:true, width:200, hidden:true};			    	else			    		if(columns[i]['isFile'])			    			myColumnDefs[i]={key:columns[i]['key'], label:columns[i]['label'], sortable:true, width:200,formatter:"myCustomI"};			    		else{			    			if(order=="")			    				order=columns[i]['key'];			    			myColumnDefs[i]={key:columns[i]['key'], label:columns[i]['label'], sortable:true, width:200,formatter:"myCustomUnescape"};			    		}			}	    }						var myCustomSend = function(elCell, oRecord, oColumn, oData) {			elCell.innerHTML = '<center><a href="javascript:sendPass(\''+oRecord.getData("_entity")+'\',\''+oRecord.getData("_key")+'\')"><img src="img/send_pass.gif"/></a></center>';		}				var myCustomDelete = function(elCell, oRecord, oColumn, oData) {			var parent="";			if (entity['parent']['value']!=null && entity['parent']['value']!="")				parent="','"+entity['parent']['value'];							elCell.innerHTML = '<center><a href="javascript:borrar(\''+oRecord.getData("_entity")+'\',\''+oRecord.getData("_key")+parent+'\')"><img src="img/delete.gif"/></a></center>';						}		var myCustomUpdate = function(elCell, oRecord, oColumn, oData) {			var parent="";			if (entity['parent']['value']!=null && entity['parent']['value']!="")				parent="','"+entity['parent']['value'];			elCell.innerHTML = '<center><a href="javascript:consultar(\''+oRecord.getData("_entity")+'\',\''+oRecord.getData("_key")+parent+'\')"><img src="img/update.gif"/></a></center>';		}				YAHOO.widget.DataTable.Formatter.myCustomD = myCustomDelete;		YAHOO.widget.DataTable.Formatter.myCustomU = myCustomUpdate;		if (hasPass)			YAHOO.widget.DataTable.Formatter.myCustomS = myCustomSend;				if (hasPass){	    	myColumnDefs[i]={key:"send", label:"Enviar Pass", formatter:"myCustomS", width:200};	    	i++	    }	    myColumnDefs[i]={key:"delete", label:"eliminar", formatter:"myCustomD"};	    myColumnDefs[i+1]={key:"update", label:"actualizar", formatter:"myCustomU"};	    	    		    // Custom parser 	    var stringToDate = function(sData) { 	        var array = sData.split("-"); 	        return new Date(array[1] + " " + array[0] + ", " + array[2]); 	    }; 	     	    // DataSource instance 	    var myDataSource = new YAHOO.util.DataSource("libs/actions/listar.php?i="+entity['idEntity']+"&p="+entity['parent']['value']+"&"); 	    myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSON; 	    var mFields=new Array(total);	    for(i=0;i<=total;i++){	    	mFields[i]={key:columns[i]['key']};	    }	    myDataSource.responseSchema = { 	        resultsList: "records", 	        fields: mFields,	        metaFields: { 	            totalRecords: "totalRecords" // Access to value in the server response 	        } 	    }; 		// DataTable configuration 		if (order=="")			order=columns[1]['key'];		var myConfigs = { 			initialRequest: "sort="+order+"&dir=asc&startIndex=0&results=20", // Initial request for first page of data 			dynamicData: true, // Enables dynamic server-driven data 			sortedBy : {key:order, dir:YAHOO.widget.DataTable.CLASS_ASC}, // Sets UI initial sort arrow 			paginator: new YAHOO.widget.Paginator({ rowsPerPage:20 }) // Enables pagination  		}; 		// DataTable instance 		var container="listado";		if (entity['isChild'])			container="listado_child"+entity['idEntity'];					myDataTable = new YAHOO.widget.DataTable(container, myColumnDefs, myDataSource, myConfigs); 				//var myDataTable = new YAHOO.widget.DataTable("listado", myColumnDefs, myDataSource); 		// Update totalRecords on the fly with value from server 		myDataTable.handleDataReturnPayload = function(oRequest, oResponse, oPayload) { 			oPayload.totalRecords = oResponse.meta.totalRecords; 			return oPayload; 					} 		resize();				//boton buscar		document.getElementById("label_filtered").innerHTML="";		if (entity['filtered']!="")			document.getElementById("label_filtered").innerHTML=entity['filtered'];				document.getElementById("button_search").innerHTML="";		if (entity['isSearchable']){					// Define various event handlers for Dialog			var handleSubmit = function() {				this.submit();				//oDialogo.hide();							};			var handleCancel = function() {				this.cancel();			};						var handleSuccess = function(o) {				var response = o.responseText;				listar(entity['idEntity']);			};			var handleFailure = function(o) {				alert("Submission failed: " + o.status);			};						// Instantiate the Dialog			oDialogo = new YAHOO.widget.Dialog("dialog_search", 							{ width : "300px",							  fixedcenter : true,							  visible : false, 							  constraintoviewport : true,							  buttons : [ { text:"Aceptar", handler:handleSubmit, isDefault:true },								      { text:"Cancelar", handler:handleCancel } ]							});										//Evita parpadeos			document.getElementById("dialog_search").style.display="block";			// Validate the entries in the form to require that both first and last name are entered			oDialogo.validate = function() {				return true;				/*var data = this.getData();				if (data.firstname == "" || data.lastname == "") {					alert("Please enter your first and last names.");					return false;				} else {					return true;				}*/			};						oDialogo.callback = { success: handleSuccess,						     	failure: handleFailure };						oDialogo.render();					var oButtonSearch = new YAHOO.widget.Button({  						type: "link",  						id: "buttonSearch",  						label: "Buscar",  						href: "javascript:oDialogo.show()",  						container: "button_search" });									var htmlSearch="<input type='hidden' name='i' id='i' value='"+entity['idEntity']+"'/>";			for(i=0;i<=total;i++){				if (!columns[i]['isPass'] && !columns[i]['isFile'] && columns[i]['key']!="_entity" && columns[i]['key']!="_key")					htmlSearch+="<div><label for'"+columns[i]['key']+"'>"+columns[i]['label']+"</label><input type='text' name='sea_"+columns[i]['key']+"' id='sea_"+columns[i]['key']+"'/></div>";		    }		    document.getElementById("dialog_search_fields").innerHTML=htmlSearch;								}		//genera el detalle		dialog=false;				container="button_nuevo";		click="javascript:consultar("+entity['idEntity']+")";		if (entity['isChild']){			container="button_nuevo_child"+entity['idEntity'];			if (entity['parent']['value']=="")				click="javascript:alert('Introduzca antes los datos principales.');";			else				click="javascript:consultar("+entity['idEntity']+",null,'"+entity['parent']['value']+"')";		}		document.getElementById(container).innerHTML="";				if (!dialog){			//boton nuevo			if (entity['buttonNew']){				var oButtonNew = new YAHOO.widget.Button({  				    type: "link",  				    id: "buttonNew",  				    label: "Nuevo",  				    href: click,  				    container: container }); 			}						}else{									// Define various event handlers for Dialog			var handleSubmit = function() {				this.submit();				//oDialogo.hide();							};			var handleCancel = function() {				this.cancel();			};						var handleSuccess = function(o) {				var response = o.responseText;				alert("ok");				listar(entity['idEntity']);			};			var handleFailure = function(o) {				alert("Submission failed: " + o.status);			};						// Instantiate the Dialog			oDialogo = new YAHOO.widget.Dialog("dialog_detail", 							{ width : "300px",							  fixedcenter : true,							  visible : false, 							  constraintoviewport : true,							  buttons : [ { text:"Aceptar", handler:handleSubmit, isDefault:true },								      { text:"Cancelar", handler:handleCancel } ]							});										//Evita parpadeos			document.getElementById("dialog_detail").style.display="block";			// Validate the entries in the form to require that both first and last name are entered			oDialogo.validate = function() {				return true;				/*var data = this.getData();				if (data.firstname == "" || data.lastname == "") {					alert("Please enter your first and last names.");					return false;				} else {					return true;				}*/			};						oDialogo.callback = { success: handleSuccess,						     	failure: handleFailure };						oDialogo.render();						//boton nuevo			var oButtonNew = new YAHOO.widget.Button({  			    type: "link",  			    id: "buttonNew",  			    label: "Nuevo",  			    href: "javascript:oDialogo.show()",			    container: container }); 					//var html="<form method='POST' action='libs/actions/insertar.php'>";			var html="<input type='hidden' name='i' id='i' value='"+entity['idEntity']+"'/>";			for(i=0;i<=total;i++){				html+="<label for'"+columns[i]['key']+"'>"+columns[i]['label']+"</label><input type='text' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"'/>";		    }		    //html+="</form>";		    document.getElementById("dialog_detail_fields").innerHTML=html;		}				if (!entity['isChild']){			document.getElementById("panel_listado").style.display="block";			document.getElementById("panel_detalle").style.display="none";			document.getElementById("panel_hook").style.display="none";		}						return { 			ds: myDataSource, 			dt: myDataTable 		}; 	}();	removeRequest(); }}function sendPass(idEntidad, idRow){		conSend=crearXMLHttpRequest();	conSend.onreadystatechange = cbSendPass;	conSend.open('GET','libs/actions/sendPass.php?i='+idEntidad+"&val="+idRow, true);	addRequest();	conSend.send(null);}function cbSendPass(){	if(conSend.readyState == 4)	{		removeRequest(); 		if(conSend.responseText=="OK")			alert("Se ha regenerado la password y ha sido enviada correctamente");		else			alert(conSend.responseText);	}}//CONSULTARvar conConsultar;function consultar(idEntidad, idRow, parent, estado, col){		if(estado!=undefined && estado!="undefined" && estado!=""){		document.getElementById('estado').innerHTML=estado+"<div id='link_ayuda'></div>";		document.getElementById('estado').style.backgroundColor="#"+col;	}		var paramParent="";	if (parent!=undefined)		paramParent="&p="+parent;		conConsultar=crearXMLHttpRequest();	conConsultar.onreadystatechange = cbConsultar;	//obtiene la estructura del listado	if (idRow!=null)		conConsultar.open('GET','libs/actions/consultar.php?i='+idEntidad+"&val="+idRow+paramParent, true);	else		conConsultar.open('GET','libs/actions/consultar.php?i='+idEntidad+paramParent, true);	addRequest();	conConsultar.send(null);}var myEditor=new Array();var editores=new Array();function cbConsultar(){		if(conConsultar.readyState == 4)	{		var datos=JSON.parse(conConsultar.responseText);				var childs=datos[1];		var columns=datos[0];		var entity=datos[2];	    var total=columns.length-1;	    var htmlAdjuntos="";	    var divKey="";	    var adjuntoKey="";	    	    if (entity['isChild']){	    	var html="<form id='form_detail_child"+entity['idEntity']+"'><table>";	    	html+="<input type='hidden' name='i' id='i' value='"+entity['idEntity']+"'/>";	    	html+="<input type='hidden' name='"+entity['parent']['key']+"' id='"+entity['parent']['key']+"' value='"+entity['parent']['value']+"'/>";	    	adjuntoKey="_"+entity['idEntity'];	    }	    else{	    	var html="<form id='form_detail'><table>";			html+="<input type='hidden' name='i' id='i' value='"+entity['idEntity']+"'/>";		}		if(entity['help_file']!="")			document.getElementById('link_ayuda').innerHTML="<a href='javascript:showHelp(\"<?=HELP_PATH?>"+entity['help_file']+"\")' >Ayuda</ayuda>";		var keyValue="";		var primerosAdjuntos=true;		var primero="";		var size=0;		var maxlength=0;		editores=new Array();		if(!entity['isChild'])			myEditor=new Array();		for(i=0;i<=total;i++){			columns[i]['value']=unescape(columns[i]['value']);			size=columns[i]['size'];			maxlength=columns[i]['maxlength'];			var disabled="";			if(columns[i]['locked']=="s")				disabled="disabled";			if (columns[i]['key']=="_key"){				var v=columns[i]['value']				if (v=="null")					v="";				divKey="<div id='d_"+columns[i]['key']+adjuntoKey+"'><input type='hidden' name='"+columns[i]['key']+adjuntoKey+"' id='"+columns[i]['key']+adjuntoKey+"' value='"+v+"'/></div>";				keyValue=columns[i]['value'];				html+=divKey;			}else{				if (primero=="")					var primero=columns[i]['key'];				if (columns[i]['ref_table']!=null && columns[i]['ref_table']!=""){					if (columns[i]['ref_depends']=="")						cargarComboByTable(columns[i]['ref_table'],columns[i]['ref_row'],columns[i]['key'],columns[i]['value']);					else{						//La llamada se ejecutara cuando el combo del que depende cambie						html=html.replace("id='"+columns[i]['ref_depends']+"'", "id='"+columns[i]['ref_depends']+"' onchange='cargarComboByTable(\""+columns[i]['ref_table']+"\",\""+columns[i]['ref_row']+"\",\""+columns[i]['key']+"\",\""+columns[i]['value']+"\",\""+columns[i]['ref_row_depends']+"\",this.value)'");					}					html+="<tr id='d_"+columns[i]['key']+"' ><td class='label'>"+columns[i]['label']+"</td><td><select name='"+columns[i]['key']+"' ref_row='"+columns[i]['ref_row']+"' id='"+columns[i]['key']+"'></select><td>";									}				else{					if (columns[i]['entity_ref']!=0){						cargarCombo(columns[i]['entity_ref'],columns[i]['key'],columns[i]['value']);						html+="<tr id='d_"+columns[i]['key']+"' ><td class='label'>"+columns[i]['label']+"</td><td><select name='"+columns[i]['key']+"' id='"+columns[i]['key']+"'></select></td>";					}					else{						if (columns[i]['multilanguage']=="n"){							if (columns[i]['file']=="s"){								htmlAdjuntos+="<tr id='d_"+columns[i]['key']+"'>";								if (primerosAdjuntos){									htmlAdjuntos+='<input type="hidden" name="MAX_FILE_SIZE" value="100000000">';									htmlAdjuntos+='<input type="hidden" name="p" id="p" value="'+entity['parent']['value']+'">';								}								htmlAdjuntos+="<td class='label'>"+columns[i]['label']+"</td><td><input type='file' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='"+columns[i]['value']+"'/>";								if(columns[i]['value']!="")									htmlAdjuntos+="<img src='img/check.gif'/>"								htmlAdjuntos+="</td>";															}else{								if (columns[i]['isdate']=="s"){									//html+="<div id='d_"+columns[i]['key']+"'><span class='label'>"+columns[i]['label']+"</span><input type='text' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='"+columns[i]['value']+"' size='10' maxlength='10'/><span><button type='button' style='right:50px;' id='show"+columns[i]['key']+"'>...</button></span></div>";									html+="<tr id='d_"+columns[i]['key']+"'><td class='label'>"+columns[i]['label']+"</td><td><input type='text' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='"+columns[i]['value']+"' size='10' maxlength='10'/><span><button type='button' id='show"+columns[i]['key']+"'>...</button></span></td>";									crearCampoFecha(columns[i]['key']);																	}else{									if (columns[i]['ischeck']=="s"){										//pinta el check										var checked="";										if (columns[i]['value'].toLowerCase()=="s")											checked="checked"										html+="<tr id='d_"+columns[i]['key']+"'><td class='label'>"+columns[i]['label']+"</td><td><input "+checked+" type='checkbox' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' /></td>";									}else{										if (columns[i]['istext']=="s"){											//textarea											//if (columns[i]['fckeditor']=="s")												//todo crear fckeditor mediante javascript												//html+="<div id='d_"+columns[i]['key']+"'><span>"+columns[i]['label']+"</span><input type='text' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='"+columns[i]['value']+"'/></div>";											//else												if(columns[i]['iseditor']=="s"){													html+="<tr id='d_"+columns[i]['key']+"1' ><td>&nbsp;</td><td class='label' style='text-align:left;'>"+columns[i]['label']+"</td></tr><tr id='d_"+columns[i]['key']+"2' ><td>&nbsp;</td><td><textarea name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' rows='6' cols='40'>"+columns[i]['value']+"</textarea></td>";													l=editores.length													editores[l]=new Array();													editores[l][0]=columns[i]['key'];													editores[l][1]=columns[i]['label'];												}												else													html+="<tr id='d_"+columns[i]['key']+"' ><td class='label'>"+columns[i]['label']+"</td><td><textarea name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' rows='6' cols='40'>"+columns[i]['value']+"</textarea></td>";																					}else{											if (columns[i]['isPass']=='s'){												html+="<tr id='d_"+columns[i]['key']+"'><td class='label'>"+columns[i]['label']+"</td><td><input type='password' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='aaaaaaaa' size='"+size+"' maxlength='"+maxlength+"'/></td>";												html+="<tr id='d_"+columns[i]['key']+"'><td class='label'>Confirmar "+columns[i]['label']+"</td><td><input type='password' name='_"+columns[i]['key']+"' id='_"+columns[i]['key']+"'  size='"+size+"' maxlength='"+maxlength+"'/></td>";											}else												html+="<tr id='d_"+columns[i]['key']+"'><td class='label'>"+columns[i]['label']+"</td><td><input "+disabled+" type='text' name='"+columns[i]['key']+"' id='"+columns[i]['key']+"' value='"+columns[i]['value']+"' size='"+size+"' maxlength='"+maxlength+"'/></td>";										}									}								}							}						}					}				}                                var info="";                                if(columns[i]['info']!=null && columns[i]['info']!="null")                                    info=columns[i]['info'];                                html+="<td class='info'>"+info+"</td></tr>";			}				    }	    //multiidioma	    if (numIdiomas>0)	    	var idiomas=new Array(numIdiomas);	    var idi=false;	    j=0;	    	    //TODO	    jj=0;	    	    for(i=0;i<=total;i++){	    				if (columns[i]['multilanguage']=="s"){				size=columns[i]['size'];				maxlength=columns[i]['maxlength'];				idi=true;				//for(j=0;j<numIdiomas;j++){					//key=columns[i]['key']+"-"+aIdiomas[j][0];					key=columns[i]['key'];					if (columns[i]['istext']=="s"){						if(columns[i]['iseditor']=="s"){							idiomas[jj]="<tr id='d_"+key+"'><td class='label'>"+columns[i]['label']+"("+aIdiomas[j][1]+")</td><td><textarea name='"+key+"' id='"+key+"' rows='6' cols='40'>"+columns[i]['value']+"</textarea></td></tr>";							l=editores.length							editores[l]=new Array();							editores[l][0]=key;							editores[l][1]=columns[i]['label']+"("+aIdiomas[j][1]+")";						}						else							idiomas[jj]="<tr id='d_"+key+"'><td class='label'>"+columns[i]['label']+"("+aIdiomas[j][1]+")</td><td><textarea name='"+key+"' id='"+key+"' rows='6' cols='40'>"+columns[i]['value']+"</textarea></td></tr>";					}else						idiomas[jj]="<tr id='"+key+"'><td class='label'>"+columns[i]['label']+"("+aIdiomas[j][1]+")</td><td><input type='text' name='"+key+"' id='"+key+"' value='"+columns[i]['value']+"' size='"+size+"' maxlength='"+maxlength+"'/></td></tr>";					j++;					jj++;					if (j>=numIdiomas)						j=0;				//}			}				    }	    if(idi){	    	//for(i=0;i<numIdiomas;i++){	    	for(i=0;i<jj;i++){	    		html+="<div id=idiomas"+i+">"+idiomas[i]+"</div>";				//html+="<div id="+aIdiomas[i][0]+">"+idiomas[i]+"</div>";			}	    }	    if (htmlAdjuntos!=""){	    	if(entity["isChild"])	    		frm="frm_adjuntos_child"+entity['idEntity']+"'";	    	else	    		frm="frm_adjuntos";		    htmlAdjuntos="<form name='"+frm+"' id='"+frm+"' action='./libs/actions/upload.php' method='post' enctype='multipart/form-data' target='upload_target'><table><input type='hidden' name='i' id='i' value='"+entity['idEntity']+"'/>"+divKey+htmlAdjuntos;		    htmlAdjuntos+="</table></form>";		}	    var container="panel_detalle_fields";	    if (entity['isChild'])	    	container="panel_detalle_fields_child"+entity['idEntity'];	    if (childs!=null){			var total=childs.length;			if (entity['layout']==0){				htmlTabs='<div id="demo" class="yui-navset">';				htmlTabs+='<ul class="yui-nav">';				htmlTabs+='<li class="selected"><a href="#tab1"><em>Datos</em></a></li>';				for(i=0;i<total;i++){					htmlTabs+='<li><a href="#tab'+(i+2)+'"><em>'+childs[i]['title']+'</em></a></li>';				}				htmlTabs+='</ul>';				htmlTabs+='<div class="yui-content">';				htmlTabs+='<div id="tab1">'+html+'</form></table>'+htmlAdjuntos+'</div>';			}else{				htmlTabs='<div><div>';				htmlTabs+="<div class='sep_entity'>Datos</div>";				htmlTabs+='<div id="tab1">'+html+'</form></table>'+htmlAdjuntos+'</div>';				if (entity['layout']==1){					htmlTabs+='<div style="text-align:right;margin:10px 0"><div style="float:right" id="button_aceptar_detalle_plain"></div>';					htmlTabs+='<div id="button_cancelar_detalle_plain"></div></div>';				}			}			for(i=0;i<total;i++){				if (entity['layout']==1){					htmlTabs+="<div class='sep_entity'>"+childs[i]['title']+"</div>";				}				htmlTabs+='<div id="tab'+i+2+'" style="padding:0 5px;">';					htmlTabs+='<div id="panel_listado_child'+childs[i]['id_entidad']+'">';						htmlTabs+='<div id="button_nuevo_child'+childs[i]['id_entidad']+'"></div>';						htmlTabs+='<div id="listado_child'+childs[i]['id_entidad']+'"></div>';					htmlTabs+='</div>';					htmlTabs+='<div id="panel_detalle_child'+childs[i]['id_entidad']+'">';						htmlTabs+='<div id="panel_detalle_fields_child'+childs[i]['id_entidad']+'"></div>';						if (entity['layout']==1){							htmlTabs+='<div style="text-align:right;margin-bottom:10px;"><div style="float:right" id="button_aceptar_detalle_child'+childs[i]['id_entidad']+'"></div>';							htmlTabs+='<div id="button_cancelar_detalle_child'+childs[i]['id_entidad']+'"></div></div>';													}else{							htmlTabs+='<div style="float:left" id="button_cancelar_detalle_child'+childs[i]['id_entidad']+'"></div>';							htmlTabs+='<div style="float:left" id="button_aceptar_detalle_child'+childs[i]['id_entidad']+'"></div>';						}					htmlTabs+='</div>';				htmlTabs+='</div>';				if (childs[i]['hook']!=null && childs[i]['hook']!=""){					loadHook(childs[i]['hook'],childs[i]['id_entidad']);				}else{					if (childs[i]['hookChild']!=null && childs[i]['hookChild']!=""){						hookChild(childs[i]['id_entidad'],keyValue,childs[i]['hookChild']);					}else{						if (childs[i]['maintance_type']==1)								consultar(childs[i]['id_entidad'],childs[i]['key_value'],keyValue);						else							if (childs[i]['layout']==0)									listar(childs[i]['id_entidad'],keyValue);							else								specialLayout(childs[i]['id_entidad'],keyValue,childs[i]['layout']);					}				}			}									htmlTabs+='</div></div>';						document.getElementById(container).innerHTML=htmlTabs;		}	    else{	    	document.getElementById(container).innerHTML=html+'</table></form>'+htmlAdjuntos;		}	    		    var tabView = new YAHOO.widget.TabView('demo');	    	    if (entity['isChild']){		    document.getElementById("panel_listado_child"+entity['idEntity']).style.display="none";			document.getElementById("panel_detalle_child"+entity['idEntity']).style.display="block";			document.getElementById("button_aceptar_detalle_child"+entity['idEntity']).innerHTML="";			var oButtonAceptar = new YAHOO.widget.Button({  			    type: "link",  			    id: "buttonAceptar",  			    label: "Aceptar",  			    href: "javascript:aceptarDetalle('"+entity['idEntity']+"')",  			    container: "button_aceptar_detalle_child"+entity['idEntity'] }); 						document.getElementById("button_cancelar_detalle_child"+entity['idEntity']).innerHTML="";    			var oButtonCancelar = new YAHOO.widget.Button({  			    type: "link",  			    id: "buttonCancelar",  			    label: "Cancelar",  			    href: "javascript:cancelarDetalle('"+entity['idEntity']+"')",  			    container: "button_cancelar_detalle_child"+entity['idEntity'] }); 					}else{			document.getElementById("panel_listado").style.display="none";			document.getElementById("panel_hook").style.display="none";			document.getElementById("panel_detalle").style.display="block";			if(document.getElementById("button_aceptar_detalle")!=null)				document.getElementById("button_aceptar_detalle").innerHTML="";			if(document.getElementById("button_aceptar_detalle_plain")!=null)				document.getElementById("button_aceptar_detalle_plain").innerHTML="";						if(document.getElementById("button_cancelar_detalle")!=null)				document.getElementById("button_cancelar_detalle").innerHTML="";    			if(document.getElementById("button_cancelar_detalle_plain")!=null)				document.getElementById("button_cancelar_detalle_plain").innerHTML="";    			if (entity['layout']==0){											var oButtonAceptar = new YAHOO.widget.Button({  					type: "link",  					id: "buttonAceptar",  					label: "Aceptar",  					href: "javascript:aceptarDetalle()",  					container: "button_aceptar_detalle"}); 								var oButtonCancelar = new YAHOO.widget.Button({  					type: "link",  					id: "buttonCancelar",  					label: "Cancelar",  					href: "javascript:cancelarDetalle()",  					container: "button_cancelar_detalle"}); 			}else{											var oButtonAceptar = new YAHOO.widget.Button({  					type: "link",  					id: "buttonAceptar",  					label: "Aceptar",  					href: "javascript:aceptarDetalle()",  					container: "button_aceptar_detalle_plain"}); 								var oButtonCancelar = new YAHOO.widget.Button({  					type: "link",  					id: "buttonCancelar",  					label: "Volver",  					href: "javascript:cancelarDetalle()",  					container: "button_cancelar_detalle_plain"}); 			}		}									    for (i=0;i<editores.length;i++){			var myConfig = {				height: '150px',				width: '600px',				dompath: true,				focusAtStart: false			};	    				l=myEditor.length			myEditor[l]=new Array();		    myEditor[l][0]=editores[i][0];			myEditor[l][1] = new YAHOO.widget.SimpleEditor(editores[i][0], myConfig,"iii");			myEditor[l][1].set("title","kk");			myEditor[l][1]._defaultToolbar.buttonType = 'advanced';			myEditor[l][1]._defaultToolbar.title="jj";			myEditor[l][1]._defaultToolbar.setTitle="jj";						myEditor[l][1].render();		}											if (document.getElementById(primero)!=null)			document.getElementById(primero).focus();		removeRequest();	}}//ELIMINARvar conBorrar;function borrar(idEntidad, idRow, parent){	var paramParent="";	if (parent!=undefined)		paramParent="&p="+parent;			conBorrar=crearXMLHttpRequest();	conBorrar.onreadystatechange = cbBorrar;	conBorrar.open('GET','libs/actions/borrar.php?i='+idEntidad+"&_key="+idRow+paramParent, true);	addRequest()	conBorrar.send(null);}function cbBorrar(){	if(conBorrar.readyState == 4)	{				var a=conBorrar.responseText.split("#");		if (a[0]=="OK"){			var idEntidad=a[1];			var parent=a[2];			if (parent!="")				listar(idEntidad,parent);			else				listar(idEntidad);		}		else			alert(conBorrar.responseText);		removeRequest();	}}//CARGAR COMBO//LISTARvar conCargarCombo;var colaCargaCombo=new Array();function cargarCombo(idEntidad, combo, value){	if (conCargarCombo==null){				conCargarCombo=crearXMLHttpRequest();		conCargarCombo.onreadystatechange = cbCargarCombo;		//obtiene la estructura del listado		conCargarCombo.open('GET','libs/actions/cargarCombo.php?i='+idEntidad+"&combo="+combo+"&val="+value, true);		addRequest()		conCargarCombo.send(null);	}else{		var item=new Array(3)		item[0]=idEntidad;		item[1]=combo;		item[2]=value;		colaCargaCombo[colaCargaCombo.length]=item;	}}function cbCargarCombo(){	if(conCargarCombo.readyState == 4)	{		removeRequest();		if(conCargarCombo.responseText!=""){		    var datos=JSON.parse(conCargarCombo.responseText);		    conCargarCombo=null;		    if (colaCargaCombo.length>0){		    	k=colaCargaCombo.length-1;		    	cargarCombo(colaCargaCombo[k][0],colaCargaCombo[k][1],colaCargaCombo[k][2]);		    	colaCargaCombo.splice(k,1);		    }		    var valor=datos[0]		    var combo=datos[1]		    var columns=datos[2];		    total=columns.length-1;		    var select=document.getElementById(combo);		    select.innerHTML="";			select.options[select.options.length]=new Option(" ","");		    for(i=0;i<=total;i++){		    	select.options[select.options.length] = new Option(columns[i]['value'], columns[i]['_key']);				if (total==0){					select.options[1].selected=true;				}		    }			if(valor.trim()!="")				document.getElementById(combo).value=valor;		 }		 		   	    	}}var conCargarComboByTable;var colaCargaComboByTable=new Array();function cargarComboByTable(table, row,combo,val,depends, dependsValue){	if (conCargarComboByTable==null){				conCargarComboByTable=crearXMLHttpRequest();		conCargarComboByTable.onreadystatechange = cbCargarComboByTable;		//obtiene la estructura del listado		conCargarComboByTable.open('GET','libs/actions/cargarCombo.php?t='+table+"&row="+row+"&combo="+combo+"&val="+val+"&depends="+depends+"&dependsValue="+escape(dependsValue), true);		conCargarComboByTable.send(null);	}else{		var item=new Array(3)		item[0]=table;		item[1]=row;		item[2]=combo;		item[3]=val;		item[4]=depends;		item[5]=dependsValue;		colaCargaComboByTable[colaCargaComboByTable.length]=item;	}}function cbCargarComboByTable(){	if(conCargarComboByTable.readyState == 4)	{		if(conCargarComboByTable.responseText!=""){			removeRequest();		    var datos=JSON.parse(conCargarComboByTable.responseText);		    conCargarComboByTable=null;		    if (colaCargaComboByTable.length>0){		    	k=colaCargaComboByTable.length-1;		    	cargarComboByTable(colaCargaComboByTable[k][0],colaCargaComboByTable[k][1],colaCargaComboByTable[k][2],colaCargaComboByTable[k][3],colaCargaComboByTable[k][4],colaCargaComboByTable[k][5]);		    	colaCargaComboByTable.splice(k,1);		    }		    var valor=datos[0]		    var combo=datos[1]		    var columns=datos[2];		    if (columns==null)		    	total=0;		    else		    	total=columns.length-1;		    var select=document.getElementById(combo);		    select.innerHTML="";			select.options[select.options.length]=new Option(" ","");		    for(i=0;i<=total;i++){		    	/*var option=document.createElement("option");		    	option.value=columns[i]['_key'];		    	alert(option.text);		    	option.text=columns[i]['value'];		    	alert(option.text);		    	document.getElementById(combo).appendChild(option);*/		    			    	select.options[select.options.length] = new Option(columns[i]['value'], columns[i]['_key']);		    }		    document.getElementById(combo).value=valor;		    if (select.onchange!=null)		    	select.onchange();		 }	}}var requests=0;function addRequest(){	requests++;	document.getElementById("loading").style.display="block";}function removeRequest(){	requests--;	setTimeout("poolLoading()",300)}function poolLoading(){	if (requests<=0)		document.getElementById("loading").style.display="none";}function getThumb(path){	var tokens=path.split("/");	var num=tokens.length;	var p="";	for (i=0;i<num-1;i++)		p+=tokens[i]+"/";		p+="x20/thumb_"+tokens[num-1];	return p;}</script>